@tailwind base;
@tailwind components;
@tailwind utilities;

/* Fix for ghost Mapbox popup tip appearing in wrong location */
.mapboxgl-popup-tip::before {
  display: none !important;
}

@layer base {
  :root {
    --app-header-height: 50px;
    
    /* Mobile viewport consistency */
    --vh: 1vh;
    --mobile-vh: 100vh;
  }
  
  /* Fix for mobile viewport inconsistencies */
  html {
    height: 100%;
    height: -webkit-fill-available;
  }
  
  body {
    min-height: 100vh;
    min-height: -webkit-fill-available;
    
    /* Prevent horizontal scrolling on mobile */
    overflow-x: hidden;
    width: 100%;
    position: relative;
    
    /* Disable text size adjust on mobile browsers */
    -webkit-text-size-adjust: 100%;
    -moz-text-size-adjust: 100%;
    -ms-text-size-adjust: 100%;
    text-size-adjust: 100%;
    
    /* Disable tap highlight */
    -webkit-tap-highlight-color: transparent;
    
    /* Smooth scrolling */
    -webkit-overflow-scrolling: touch;
  }
  
  /* Force consistent rendering across browsers */
  * {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
  }
}

@layer components {
  .app-header {
    @apply w-full bg-white flex flex-row justify-center items-center drop-shadow-sm overflow-x-hidden;
    height: var(--app-header-height);
  }

  .app-content-full-container {
    @apply w-full h-dvh relative;

    /* height: calc(100vh - var(--app-header-height)); */
    /* margin-top: var(--app-header-height); */
  }

  .app-container {
    @apply w-full h-auto max-w-full px-4 flex flex-row box-border;
  }

  .app-sidebar-link {
    @apply transition-all flex flex-row gap-3 items-center text-sm px-2 py-3 rounded-lg hover:bg-dark-hover;

    &:hover {
      @apply text-white;

      .app-sidebar-link-icon {
        @apply transition-all scale-105 text-white;
      }
    }
  }

  .app-sidebar-link-collapsed {
    @apply transition-all flex items-center justify-center text-sm p-2 hover:bg-dark-hover/50 rounded-lg;

    &:hover {
      @apply text-white;

      .app-sidebar-link-icon {
        @apply transition-all scale-105 text-white;
      }
    }
  }

  .app-sidebar-link-active {
    @apply text-white bg-dark-hover;
    .app-sidebar-link-icon {
      @apply transition-all scale-105 text-white;
    }
  }

  .error-message {
    @apply text-red-500 text-sm;
  }

  .richtext {
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      @apply py-2 text-lg font-medium;
    }

    p {
      @apply py-2;
    }
  }
}

.map-popup {
  @apply p-4 text-black text-sm flex flex-col justify-start items-start gap-2;
  word-wrap: break-word;
  overflow-wrap: break-word;
  hyphens: auto;
  white-space: normal;
  overflow: hidden;
  min-width: 0;
  flex-shrink: 1;
}

.map-popup-title {
  @apply font-medium;
  word-wrap: break-word;
  overflow-wrap: break-word;
  white-space: normal;
  min-width: 0;
  flex-shrink: 1;
}

.map-popup-date {
  @apply text-sm font-normal text-neutral-700;
  word-wrap: break-word;
  overflow-wrap: break-word;
  white-space: normal;
  min-width: 0;
  flex-shrink: 1;
}

.map-popup-content {
  @apply font-normal;
  word-wrap: break-word;
  overflow-wrap: break-word;
  white-space: normal;
  min-width: 0;
  flex-shrink: 1;
}

.mapboxgl-popup {
}

.mapboxgl-popup-content {
  background: white !important;
  padding: 0 !important;
  margin: 0 !important;
  border-radius: 8px !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
  border: 1px solid rgba(0, 0, 0, 0.1) !important;
}

/* Original popup styles restored */
.mapboxgl-popup-tip {
  width: 0 !important;
  height: 0 !important;
  border: 10px solid transparent !important;
  border-top-color: white !important;
  border-bottom: none !important;
  margin-top: -1px !important;
}

/* Upward pointing tip for popups below marker */
.mapboxgl-popup-anchor-top .mapboxgl-popup-tip {
  border-top: none !important;
  border-bottom: 10px solid white !important;
  margin-top: 1px !important;
  margin-bottom: -1px !important;
}

.mapboxgl-popup-anchor-top .mapboxgl-popup-tip::before {
  top: 1px !important;
  border-top: none !important;
  border-bottom: 11px solid rgba(0, 0, 0, 0.1) !important;
}

/* Left pointing tip for popups to the right of marker */
.mapboxgl-popup-anchor-left .mapboxgl-popup-tip {
  border-top: 10px solid transparent !important;
  border-bottom: 10px solid transparent !important;
  border-right: 10px solid white !important;
  border-left: none !important;
  margin-left: 1px !important;
  margin-right: -1px !important;
}

.mapboxgl-popup-anchor-left .mapboxgl-popup-tip::before {
  left: 1px !important;
  border-top: 11px solid transparent !important;
  border-bottom: 11px solid transparent !important;
  border-right: 11px solid rgba(0, 0, 0, 0.1) !important;
  border-left: none !important;
}

/* Right pointing tip for popups to the left of marker */
.mapboxgl-popup-anchor-right .mapboxgl-popup-tip {
  border-top: 10px solid transparent !important;
  border-bottom: 10px solid transparent !important;
  border-left: 10px solid white !important;
  border-right: none !important;
  margin-right: 1px !important;
  margin-left: -1px !important;
}

.mapboxgl-popup-anchor-right .mapboxgl-popup-tip::before {
  left: -21px !important;
  border-top: 11px solid transparent !important;
  border-bottom: 11px solid transparent !important;
  border-left: 11px solid rgba(0, 0, 0, 0.1) !important;
  border-right: none !important;
}

/* Corner anchors - offset toward center to account for rounded corners */
.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip {
  border-top: none !important;
  border-bottom: 10px solid white !important;
  margin-top: 1px !important;
  margin-bottom: -1px !important;
  /* Move arrow toward center from top-left corner */
  transform: translateX(8px) !important;
}

.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip {
  border-top: none !important;
  border-bottom: 10px solid white !important;
  margin-top: 1px !important;
  margin-bottom: -1px !important;
  /* Move arrow toward center from top-right corner */
  transform: translateX(-8px) !important;
}

.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip {
  border-top-color: white !important;
  border-bottom: none !important;
  margin-top: -1px !important;
  /* Move arrow toward center from bottom-left corner */
  transform: translateX(8px) !important;
}

.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip {
  border-top-color: white !important;
  border-bottom: none !important;
  margin-top: -1px !important;
  /* Move arrow toward center from bottom-right corner */
  transform: translateX(-8px) !important;
}

.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip::before,
.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip::before {
  top: 1px !important;
  border-top: none !important;
  border-bottom: 11px solid rgba(0, 0, 0, 0.1) !important;
}

.map-control-group {
  @apply bg-transparent flex flex-col gap-2 shadow-none p-4 box-border;
}

.map-control button {
  @apply transition-all w-[40px] h-[40px] select-none bg-white drop-shadow flex items-center justify-center rounded-full text-lg cursor-pointer scale-100 active:scale-95 hover:!bg-white hover:!opacity-100;
}

/* Hide reCAPTCHA badge */
.grecaptcha-badge {
  visibility: hidden !important;
  opacity: 0 !important;
  pointer-events: none !important;
}

/* Navigation loading state - highest specificity */
html body.navigating {
  cursor: wait !important;
}

html body.navigating *,
html body.navigating *:hover {
  cursor: wait !important;
}

/* Prominent loading indicator */
html body.navigating::after {
  content: 'Loading...' !important;
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  height: 40px !important;
  background: #007AFF !important;
  color: white !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  font-weight: bold !important;
  font-size: 14px !important;
  z-index: 99999 !important;
  pointer-events: none !important;
  animation: pulse 1s infinite !important;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

@keyframes loadingPulse {
  0% { opacity: 0.6; }
  50% { opacity: 1; }
  100% { opacity: 0.6; }
}

/* Essential mobile viewport fixes only */
@media (max-width: 768px) {
  /* Feature card mobile consistency */
  .mobile-feature-card {
    padding: 1.5rem 1rem;
  }
  
  .mobile-feature-card img {
    height: 12rem !important;
  }
}

@media (max-width: 480px) {
  .mobile-feature-card {
    padding: 1rem 0.75rem;
  }
  
  .mobile-feature-card img {
    height: 10rem !important;
  }
}
